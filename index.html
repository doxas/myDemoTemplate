<!DOCTYPE html>
<html><head>
<script src="js/glcubic.js"></script>
<script src="js/script.js"></script>
<script id="vs" type="x-shader/x-vertex">
attribute vec3 position;
attribute vec2 texCoord;

uniform mat4 orthoMatrix;

varying vec2 vTexCoord;

void main(){
	vTexCoord = vec2(texCoord.x, 1.0 - texCoord.y);
	gl_Position = orthoMatrix * vec4(position, 1.0);
}
</script>
<script id="fs" type="x-shader/x-fragment">
precision mediump float;

uniform sampler2D texture;
uniform vec2 resolution;
uniform float hWeight[9];
uniform float vWeight[9];

varying vec2 vTexCoord;

const float redScale   = 0.298912;
const float greenScale = 0.586611;
const float blueScale  = 0.114478;
const vec3  monochromeScale = vec3(redScale, greenScale, blueScale);

void main(){
	vec2 offset[9];
	offset[0] = vec2(-1.0, -1.0);
	offset[1] = vec2( 0.0, -1.0);
	offset[2] = vec2( 1.0, -1.0);
	offset[3] = vec2(-1.0,  0.0);
	offset[4] = vec2( 0.0,  0.0);
	offset[5] = vec2( 1.0,  0.0);
	offset[6] = vec2(-1.0,  1.0);
	offset[7] = vec2( 0.0,  1.0);
	offset[8] = vec2( 1.0,  1.0);
	vec2 p = 1.0 / resolution;
	vec3 horizonColor = vec3(0.0);
	vec3 verticalColor = vec3(0.0);
	for(int i = 0; i < 9; ++i){
		horizonColor  += texture2D(texture, (gl_FragCoord.st + offset[i]) * p).rgb * hWeight[i];
		verticalColor += texture2D(texture, (gl_FragCoord.st + offset[i]) * p).rgb * vWeight[i];
	}
	vec3 sobelColor = vec3(sqrt(horizonColor * horizonColor + verticalColor * verticalColor));
	float f = pow(dot(sobelColor, monochromeScale), 5.0);
	gl_FragColor = vec4(vec3(f), 1.0);
}
</script>
<script id="gauss_fs" type="x-shader/x-fragment">
precision mediump float;

uniform sampler2D texture;
uniform sampler2D addTexture;
uniform vec2 resolution;
uniform float weight[10];
uniform bool horizontal;
uniform bool additional;

varying vec2 vTexCoord;

void main(){
	vec3 destColor = vec3(0.0);
	vec2 p = gl_FragCoord.st;
	float bufferScale;
	if(horizontal){
		bufferScale = 1.0 / resolution.s;
		destColor += texture2D(texture, (p + vec2(-9.0, 0.0)) * bufferScale).rgb * weight[9];
		destColor += texture2D(texture, (p + vec2(-8.0, 0.0)) * bufferScale).rgb * weight[8];
		destColor += texture2D(texture, (p + vec2(-7.0, 0.0)) * bufferScale).rgb * weight[7];
		destColor += texture2D(texture, (p + vec2(-6.0, 0.0)) * bufferScale).rgb * weight[6];
		destColor += texture2D(texture, (p + vec2(-5.0, 0.0)) * bufferScale).rgb * weight[5];
		destColor += texture2D(texture, (p + vec2(-4.0, 0.0)) * bufferScale).rgb * weight[4];
		destColor += texture2D(texture, (p + vec2(-3.0, 0.0)) * bufferScale).rgb * weight[3];
		destColor += texture2D(texture, (p + vec2(-2.0, 0.0)) * bufferScale).rgb * weight[2];
		destColor += texture2D(texture, (p + vec2(-1.0, 0.0)) * bufferScale).rgb * weight[1];
		destColor += texture2D(texture, (p + vec2( 0.0, 0.0)) * bufferScale).rgb * weight[0];
		destColor += texture2D(texture, (p + vec2( 1.0, 0.0)) * bufferScale).rgb * weight[1];
		destColor += texture2D(texture, (p + vec2( 2.0, 0.0)) * bufferScale).rgb * weight[2];
		destColor += texture2D(texture, (p + vec2( 3.0, 0.0)) * bufferScale).rgb * weight[3];
		destColor += texture2D(texture, (p + vec2( 4.0, 0.0)) * bufferScale).rgb * weight[4];
		destColor += texture2D(texture, (p + vec2( 5.0, 0.0)) * bufferScale).rgb * weight[5];
		destColor += texture2D(texture, (p + vec2( 6.0, 0.0)) * bufferScale).rgb * weight[6];
		destColor += texture2D(texture, (p + vec2( 7.0, 0.0)) * bufferScale).rgb * weight[7];
		destColor += texture2D(texture, (p + vec2( 8.0, 0.0)) * bufferScale).rgb * weight[8];
		destColor += texture2D(texture, (p + vec2( 9.0, 0.0)) * bufferScale).rgb * weight[9];
	}else{
		bufferScale = 1.0 / resolution.t;
		destColor += texture2D(texture, (p + vec2(0.0, -9.0)) * bufferScale).rgb * weight[9];
		destColor += texture2D(texture, (p + vec2(0.0, -8.0)) * bufferScale).rgb * weight[8];
		destColor += texture2D(texture, (p + vec2(0.0, -7.0)) * bufferScale).rgb * weight[7];
		destColor += texture2D(texture, (p + vec2(0.0, -6.0)) * bufferScale).rgb * weight[6];
		destColor += texture2D(texture, (p + vec2(0.0, -5.0)) * bufferScale).rgb * weight[5];
		destColor += texture2D(texture, (p + vec2(0.0, -4.0)) * bufferScale).rgb * weight[4];
		destColor += texture2D(texture, (p + vec2(0.0, -3.0)) * bufferScale).rgb * weight[3];
		destColor += texture2D(texture, (p + vec2(0.0, -2.0)) * bufferScale).rgb * weight[2];
		destColor += texture2D(texture, (p + vec2(0.0, -1.0)) * bufferScale).rgb * weight[1];
		destColor += texture2D(texture, (p + vec2(0.0,  0.0)) * bufferScale).rgb * weight[0];
		destColor += texture2D(texture, (p + vec2(0.0,  1.0)) * bufferScale).rgb * weight[1];
		destColor += texture2D(texture, (p + vec2(0.0,  2.0)) * bufferScale).rgb * weight[2];
		destColor += texture2D(texture, (p + vec2(0.0,  3.0)) * bufferScale).rgb * weight[3];
		destColor += texture2D(texture, (p + vec2(0.0,  4.0)) * bufferScale).rgb * weight[4];
		destColor += texture2D(texture, (p + vec2(0.0,  5.0)) * bufferScale).rgb * weight[5];
		destColor += texture2D(texture, (p + vec2(0.0,  6.0)) * bufferScale).rgb * weight[6];
		destColor += texture2D(texture, (p + vec2(0.0,  7.0)) * bufferScale).rgb * weight[7];
		destColor += texture2D(texture, (p + vec2(0.0,  8.0)) * bufferScale).rgb * weight[8];
		destColor += texture2D(texture, (p + vec2(0.0,  9.0)) * bufferScale).rgb * weight[9];
	}
	if(additional){
		destColor += texture2D(addTexture, p * bufferScale).rgb;
	}
	gl_FragColor = vec4(destColor, 1.0);
}
</script>
<script id="light_vs" type="x-shader/x-vertex">
attribute vec3 position;
attribute vec3 normal;
attribute vec4 color;

uniform mat4 mMatrix;
uniform mat4 mvpMatrix;
uniform mat4 invMatrix;
uniform vec3 lightDirection;
uniform vec3 eyePosition;
uniform vec3 centerPoint;
uniform vec4 ambient;

varying vec4 vColor;

void main(){
	vec3 invLight = normalize(invMatrix * vec4(lightDirection, 1.0)).xyz;
	vec3 invEye   = normalize(invMatrix * vec4(eyePosition - centerPoint, 1.0)).xyz;
	vec3 halfVec  = normalize(invLight + invEye);
	float diff = clamp(dot(invLight, normal), 0.2, 1.0);
	float spec = clamp(dot(halfVec, normal), 0.0, 1.0);
	vColor = vec4(color.rgb * diff, 1.0) * ambient + vec4(vec3(pow(spec, 30.0)), 1.0);
	gl_Position = mvpMatrix * vec4(position, 1.0);
}
</script>
<script id="light_fs" type="x-shader/x-fragment">
precision mediump float;

uniform sampler2D texture;

varying vec4 vColor;

void main(){
	gl_FragColor = vColor;
}
</script>
<link rel="stylesheet" href="css/style.css">
<title>demo name</title>
</head>
<body>
	<canvas id="canvas"></canvas>
</body></html>
